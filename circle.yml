machine:
  python:
    version: 3.5.2
  node:
    version: 6.1.0

dependencies:
  cache_directories:
    - frontend/node_modules
  override:
    - pip install -e .[test]
    - cd frontend && yarn install

test:
  override:
    - pytest --cov=yawn --junitxml=$CIRCLE_TEST_REPORTS/pytest.xml yawn
    - flake8 yawn
    - cd frontend && env JEST_JUNIT_OUTPUT=$CIRCLE_TEST_REPORTS/jest.xml
      yarn test -- --coverage --testResultsProcessor jest-junit --runInBand
    # build, although it doesn't go anywhere:
    - cd frontend/ && yarn build
    - ./setup.py sdist
  post:
    - bash <(curl -s https://codecov.io/bash)
